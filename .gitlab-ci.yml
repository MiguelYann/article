image: docker:stable
services:
    - docker:18.09-dind
stages: 
    - verify 
    - build_app
    - build_container
    - package
    - release

# before_script:
#     - docker info
 


⚙ building: 
    image: node
    only: 
        - master
    stage: build_app 
    script: 
        - npm install
        - npm run build --prod
    artifacts:
        paths:
            - dist/

# 🚦 test: 
#     image: node
#     stage: verify
#     only: 
#         - master
#     script: 
#         - npm install
#         - npm run test
        
🚢 dockerise:
    dependencies:
        - ⚙ building

    only: 
        - master
    stage: build_container
    script: 
    - docker info
    - docker build -t angularapp:1.0.0 .
    - mkdir imageDocker/
    artifacts:
        paths:
            - imageDocker

☁ push_acr: 
    dependencies:
        - 🚢 dockerise
    
    image: microsoft/azure-cli
    stage: package
    only:
        - master
    script: 
        - docker info
        - docker login -u "$ACR_NAME" -p "$ACR_TOKEN" "$ACR_URL"
        - az




